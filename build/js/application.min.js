function google_map(){function e(){geocoder=new google.maps.Geocoder;var e=[{featureType:"all",stylers:[{saturation:0},{hue:"#e7ecf0"}]},{featureType:"road",stylers:[{saturation:-70}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"},{saturation:-60}]}],a=new google.maps.StyledMapType(e,{name:"Styled Map"});map=new google.maps.Map(document.getElementById("map"),{zoom:7,mapTypeId:google.maps.MapTypeId.TERRAIN,LatLngBounds:(new google.maps.LatLng(49.383639452689664,-17.39866406249996),new google.maps.LatLng(59.53530451232491,8.968523437500039)),center:new google.maps.LatLng(54.559322,-4.174804)});var s=document.getElementById("address"),o={types:["(cities)"],componentRestrictions:{country:"uk"}},t=(new google.maps.places.Autocomplete(s,o),new google.maps.InfoWindow,document.createElement("script"));t.src="assets/data/cinemas.geojsonp",map.mapTypes.set("map_style",a),map.setMapTypeId("map_style"),document.getElementsByTagName("head")[0].appendChild(t)}window.cinemalist_callback=function(e){for(var a=[],s=0;s<e.cinemas.length;s++){var o=e.cinemas[s].properties.icon,t=e.cinemas[s].geometry.location,n=e.cinemas[s].properties.url,i=e.cinemas[s].id,r=n.replace("http://","","/"),r=r.replace("/",""),l=new google.maps.Marker({position:t,icon:o,map:map,clickable:!0});geo_markers.push(l),a.push(e.cinemas[s]),l.info=new google.maps.InfoWindow({content:'<div class="info-window"><h4><strong>'+e.cinemas[s].properties.name+"</strong></h4><p>"+e.cinemas[s].properties.address+'</p><p><a href="'+n+'" target="_blank">'+r+'</a></p><div class="row"><div class="col-sm-4"><a href="#" onclick="cinema_history('+i+');  return false;" class="btn btn-primary mt1">View Info</a></div>'}),google.maps.event.addListener(l,"click",function(){this.info.open(map,this)})}sessionStorage.setItem("all_cinemas",JSON.stringify(a))},google.maps.event.addDomListener(window,"load",e)}function save_nearest_cinemas(e){$(".image-grid").hide(),map.setCenter(e),map.setZoom(12),"undefined"!=typeof customerMarker&&customerMarker.setMap(null),customerMarker=new google.maps.Marker({map:map,position:e}),closest=find_closest_n(e,3);for(var a=[],s=0;s<closest.length;s++){var o='<span class="glyphicon glyphicon-map-marker mr1" aria-hidden="true"></span>'+Math.ceil(.000621371192*closest[s].distance)+" miles away";a.push(closest[s].info.content+'<div class="col-sm-8"><p class="distance mt2 mb0">'+o+"<p></div></div>")}sessionStorage.setItem("near_cinemas",JSON.stringify(a)),show_nearest_cinemas()}function convert_address(){$(".map-form").fadeOut(400);var e=document.getElementById("address").value;geocoder.geocode({address:e},function(e,a){if(a==google.maps.GeocoderStatus.OK){var s=e[0].geometry.location;save_nearest_cinemas(s)}else alert("Geocode was not successful for the following reason: "+a)})}function use_location(){function e(e){var a=(e.coords.latitude,e.coords.longitude,new google.maps.LatLng(e.coords.latitude,e.coords.longitude));save_nearest_cinemas(a)}$(".map-form").fadeOut(400),navigator.geolocation.getCurrentPosition(e)}function find_closest_n(e,a){for(var s=[],o=0;o<geo_markers.length;o++)geo_markers[o].distance=google.maps.geometry.spherical.computeDistanceBetween(e,geo_markers[o].getPosition()),s.push(geo_markers[o]);return s.sort(sort_by_dist),s.splice(0,a)}function sort_by_dist(e,a){return e.distance-a.distance}function show_nearest_cinemas(){$(".nearest-cinema").fadeIn(400);var e=[];e=sessionStorage.getItem("near_cinemas"),nearest_cinema_parsed=JSON.parse(e);for(var a=0;a<nearest_cinema_parsed.length;a++)$('<div class="col-sm-4 col-md-3"><div class="cinema">'+nearest_cinema_parsed[a]+"</div></div>").appendTo(".data")}function cinema_history(e){var a=[];a=sessionStorage.getItem("all_cinemas");for(var s=JSON.parse(a),o=0;o<s.length;o++)if(s[o].id==e){var t=s[o].properties.name,t=t.replace(" ","_"),t=t.toLowerCase();$(".cinema-modal").append("<div class='modal fade' id='cinema_modal' tabindex='-1' role='dialog' aria-labelledby='cinema-modal-label'><div class='modal-dialog' role='document'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button><h4 class='modal-title' id='cinema-modal-label'>"+s[o].properties.name+"</h4></div><div class='modal-body'><div class='row'><div class='col-sm-6'><img src='assets/img/cinemas/"+t+".jpg' class='img-responsive'></div><div class='col-sm-6'><p>"+s[o].properties.address+"</p><p>"+s[o].properties.city+"</p><p>"+s[o].properties.postcode+"</p><p><a href='"+s[o].properties.url+"' target='_blank'>"+s[o].properties.url+"</a></p><p>Status: "+s[o].properties.status+"</p><p>Open Since: "+s[o].properties.opened+"</p></div></div></div><div class='modal-footer'>	<button type='button' class='btn btn-default' data-dismiss='modal'>Close</button></div></div></div></div>"),$("#cinema_modal").modal("show"),$("#cinema_modal").on("hidden.bs.modal",function(){$("#cinema_modal").remove()})}return!1}var map,geocoder=null,closest=[],test=[],geo_markers=[],infowindow=new google.maps.InfoWindow({});$(document).ready(function(){google_map(),$(".toggler").click(function(){$(".nearest-cinema").toggleClass("down"),$(this).find("i").toggleClass("fa-chevron-down fa-chevron-up")}),$("#address").keypress(function(e){return 13==e.which?(convert_address(),!1):void 0}),$("#location-form").submit(function(){return!1})});